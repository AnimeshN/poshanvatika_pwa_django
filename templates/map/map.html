{% extends 'map/base_map.html'%}

{% block extra_resources%}
<style>

.popupimage {
    height: 200px;
    width: 300px;
    overflow: hidden;
    border-radius: 50px;
}

#content{
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
</style>
{% endblock %}

{% block map %}
<div id="mapid" style="width: 100%; height: 100%;"></div>

  <!-- Modal Structure -->
  <div id="demo-modal" class="modal bottom-sheet"> 
    <div id="content" class="modal-content"> 
    </div> 
    <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-green btn-flat">Close</a>
      </div>
</div> 
<script>

	var mymap = L.map('mapid').setView([19.7515-1,75.7139-1], 7);
    const url = 'https://makerghat.urbansciences.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&outputFormat=json&typename=geonode:diet_data8jan';
	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
		tileSize: 512,
		zoomOffset: -1
	}).addTo(mymap);


    var geojsonMarkerOptions11 = {
                    radius: 8,
                    fillColor: "#8975fa",
                    color: "#000",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                };

    const onEachFeatureForPoint = (feature, layer) =>{
        var str1 = " <img class = 'popupimage' src='/static/map/".concat(feature.properties.image);
        var str2 = str1.concat("' alt='image not found'>").concat(`Village Name:${feature.properties.village}`);
                        // layer.bindPopup(str2);

        const table = `
        <table class='striped centered'>
        <thead>
          <tr>
              <th>Village Name</th>
              <th>${feature.properties.village}</th>
          </tr>
        </thead>

        <tbody>
          <tr>
            <td>Institution</td>
            <td>Institution Name</td>
          </tr>
        </tbody>
      </table>
      `
        layer.on("click",e => {
            document.getElementById("content").innerHTML = str2 + table;
            var elem = document.getElementById('demo-modal');
            var instance = M.Modal.getInstance(elem);
            instance.open();

        })
    }

    fetch(url).then(res => {
        res.json().then(
            function(geojsonData) {
                poshanvatika = L.geoJson(geojsonData.features, {
                pointToLayer: function(feature, latlng) {
                        return L.circleMarker(latlng, geojsonMarkerOptions11);
                },
                onEachFeature: onEachFeatureForPoint,
            }).addTo(mymap);
        })
    });

</script>
<script>

document.addEventListener('DOMContentLoaded', () => {
    var elems = document.querySelectorAll('.modal');
    var instances = M.Modal.init(elems, {opacity:.3});
});

</script>
{% endblock map%}
